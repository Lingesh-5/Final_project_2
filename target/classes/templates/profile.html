<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
</head>

<body style="background-color: aliceblue;">
    <script>
        function onload() {
            const token = sessionStorage.getItem("token");
            const id = sessionStorage.getItem("id");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);

            const requestOptions = {
                method: "GET",
                headers: myHeaders
            };
            fetch(`http://localhost:8080/user/rest/get-user/${id}`, requestOptions)
                .then((response) => response.json())
                .then((result) => {
                    const resp = result;
                    loadData(resp.body.user);
                })
                .catch((error) => console.error(error));

            function loadData(user) {
                document.getElementById("name").value = user.name;
                document.getElementById("email").value = user.email;
            }
        }
        onload();
        function edit() {
            const nameInputEl = document.getElementById("name");
            nameInputEl.readOnly = false;
            const emailInputEl = document.getElementById("email");
            emailInputEl.readOnly = false;
        }
        function saveUser() {
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const userId = sessionStorage.getItem("id");
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Authorization", "Bearer " + token);

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: JSON.stringify({ "name": name, "email": email, "userId": userId }),
                redirect: "follow"
            };
            fetch("http://localhost:8080/user/rest/save-user", requestOptions)
                .then((response) => response.text())
                .then((result) => {
                    alert(result);
                })
                .catch((error) => console.error(error));
        }
        function productPage() {
            const token = sessionStorage.getItem("token");

            const myHeaders = new Headers();
            myHeaders.append("Authorization", "Bearer " + token);
            const requestOptions = {
                method: "GET",
                headers: myHeaders,
                redirect: "follow"
            };
            fetch("http://localhost:8080/user/product-list", requestOptions)
                .then((response) => response.text())
                .then((html) => {
                    document.write(html);
                    document.close();
                })
                .catch((error) => console.error(error));
        }
    </script>
    <header>
        <div class="row border fixed-top" style="background-color:antiquewhite;">
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1"></div>
            <div class="col md-1 m-3">
                <nav class="nav"><input type="button" class="btn" value="Products" onclick="productPage()" /></nav>
            </div>
            <div class="col md-2 m-3 border-start border-dark-subtle">
                <a href="http://localhost:8080/" class="btn btn-danger link-dark"><svg
                        xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                        fill="#1f1f1f" class="d-inline">
                        <path
                            d="M216-144q-29.7 0-50.85-21.15Q144-186.3 144-216v-528q0-29.7 21.15-50.85Q186.3-816 216-816h264v72H216v528h264v72H216Zm432-168-51-51 81-81H384v-72h294l-81-81 51-51 168 168-168 168Z" />
                    </svg>Logout</a>
            </div>
        </div>
    </header>
    <main>
        <div class="container p-5 mt-5">
            <div class="border border-secondary p-3">
                <div class="border-bottom border-black">
                    <h1><svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px"
                            fill="#000000">
                            <path
                                d="M237-285q54-38 115.5-56.5T480-360q66 0 127.5 18.5T723-285q35-41 52-91t17-104q0-129.67-91.23-220.84-91.23-91.16-221-91.16Q350-792 259-700.84 168-609.67 168-480q0 54 17 104t52 91Zm243-123q-60 0-102-42t-42-102q0-60 42-102t102-42q60 0 102 42t42 102q0 60-42 102t-102 42Zm.28 312Q401-96 331-126t-122.5-82.5Q156-261 126-330.96t-30-149.5Q96-560 126-629.5q30-69.5 82.5-122T330.96-834q69.96-30 149.5-30t149.04 30q69.5 30 122 82.5T834-629.28q30 69.73 30 149Q864-401 834-331t-82.5 122.5Q699-156 629.28-126q-69.73 30-149 30Zm-.28-72q52 0 100-16.5t90-48.5q-43-27-91-41t-99-14q-51 0-99.5 13.5T290-233q42 32 90 48.5T480-168Zm0-312q30 0 51-21t21-51q0-30-21-51t-51-21q-30 0-51 21t-21 51q0 30 21 51t51 21Zm0-72Zm0 319Z" />
                        </svg> User Profile</h1>
                </div><br />
                <form>
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <label for="name" class="col-sm-2 col-form-label">Name:</label>
                        </div>
                        <div class="col-sm-5">
                            <input type="text" placeholder="Enter name" id="name" name="name" class="form-control"
                                readonly />
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-2">
                            <label for="email" class="col-sm-2 col-form-label">Email:</label>
                        </div>
                        <div class="col-sm-5">
                            <input type="text" placeholder="Enter email" id="email" name="email" class="form-control"
                                readonly />
                        </div>
                        <div class="col-sm-5"></div>
                    </div>
                    <div>
                        <input type="button" class="btn btn-primary" value="Save" onclick="saveUser()" />
                        <input type="button" value="Edit" class="btn btn-secondary" onclick="edit()" />
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>

</html>